"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createConverter = void 0;
const rxjs_1 = require("rxjs");
const NgExtension_1 = require("./NgExtension");
const queue_1 = require("./queue");
const module_1 = require("./module");
const bootstrap_1 = require("./bootstrap");
function createConverter(_ = {}) {
    const registry = new Map();
    const convert = (component) => ({
        mount(el, props, ctx, locals) {
            locals.active = true;
            if (!registry.has(component)) {
                registry.set(component, (0, bootstrap_1.prepareBootstrap)(component, props.piral));
            }
            if (!locals.props) {
                locals.props = new rxjs_1.BehaviorSubject(props);
            }
            if (!locals.queued) {
                locals.queued = Promise.resolve();
            }
            locals.queued = locals.queued.then(() => (0, queue_1.enqueue)(() => locals.active && (0, bootstrap_1.bootstrap)(registry.get(component), el, locals.props, ctx)));
        },
        update(el, props, ctx, locals) {
            locals.props.next(props);
        },
        unmount(el, locals) {
            locals.active = false;
            locals.queued = locals.queued.then((dispose) => dispose && dispose());
        },
    });
    convert.defineModule = module_1.defineModule;
    convert.Extension = NgExtension_1.NgExtension;
    return convert;
}
exports.createConverter = createConverter;
//# sourceMappingURL=converter.js.map