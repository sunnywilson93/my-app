"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.liveLogs = exports.allLogsOf = exports.recentLogsOf = void 0;
const helpers_1 = require("../helpers");
const maxEntries = 50;
function recentLogsOf(server) {
    return (req, res) => {
        res.json({
            entries: helpers_1.filterReverse(server.logs, (_1, _2, i) => i < maxEntries),
        });
    };
}
exports.recentLogsOf = recentLogsOf;
function allLogsOf(server) {
    return (req, res) => {
        server.logs.splice(0, server.logs.length);
        res.sendStatus(200);
    };
}
exports.allLogsOf = allLogsOf;
function liveLogs(server) {
    const clients = [];
    const broadcast = (entry) => {
        for (const client of clients) {
            client.send(JSON.stringify(entry));
        }
    };
    server.on('logged', (item) => {
        broadcast(item);
    });
    return (ws) => {
        clients.push(ws);
        ws.on('close', () => {
            clients.splice(clients.indexOf(ws), 1);
        });
    };
}
exports.liveLogs = liveLogs;
