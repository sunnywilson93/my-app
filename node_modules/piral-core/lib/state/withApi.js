"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withApi = void 0;
const React = require("react");
const components_1 = require("../components");
const utils_1 = require("../utils");
const DefaultWrapper = (props) => (0, utils_1.defaultRender)(props.children);
function getWrapper(wrappers, wrapperType) {
    const WrapAll = wrappers['*'];
    const WrapType = wrappers[wrapperType];
    if (WrapAll && WrapType) {
        return (props) => (React.createElement(WrapAll, Object.assign({}, props),
            React.createElement(WrapType, Object.assign({}, props))));
    }
    return WrapType || WrapAll || DefaultWrapper;
}
function makeWrapper(context, outerProps, wrapperType, errorType) {
    const OuterWrapper = context.readState((m) => getWrapper(m.registry.wrappers, wrapperType));
    return (props) => (React.createElement(OuterWrapper, Object.assign({}, outerProps, props),
        React.createElement(components_1.ErrorBoundary, Object.assign({}, outerProps, props, { errorType: errorType }), props.children)));
}
function withApi(context, component, piral, errorType, wrapperType = errorType, captured = {}) {
    const outerProps = Object.assign(Object.assign({}, captured), { piral });
    const converters = context.converters;
    const Wrapper = makeWrapper(context, outerProps, wrapperType, errorType);
    return (0, components_1.wrapComponent)(converters, component, outerProps, Wrapper);
}
exports.withApi = withApi;
//# sourceMappingURL=withApi.js.map